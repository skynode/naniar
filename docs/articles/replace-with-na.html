<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Replacing values with NA • naniar</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">naniar</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/getting-started-w-naniar.html">Getting Started</a>
</li>
<li>
  <a href="../articles/naniar-visualisation.html">Gallery</a>
</li>
<li>
  <a href="../articles/replace-with-na.html">Replace with NA</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/njtierney/naniar">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Replacing values with NA</h1>
                        <h4 class="author">Nicholas Tierney</h4>
            
            <h4 class="date">2018-02-08</h4>
          </div>

    
    
<div class="contents">
<p>When you are dealing with missing values, you might want to replace values with a missing values (NA). This is useful in cases when you know the origin of the data and can be certain which values should be missing. For example, you might know that all values of “N/A”, “N A”, and “Not Available”, or -99, or -1 are supposed to be missing.</p>
<p><code>naniar</code> provides functions to specifically work on this type of problem using the function <code>replace_with_na</code>. This function is the compliment to <code><a href="http://www.rdocumentation.org/packages/tidyr/topics/replace_na">tidyr::replace_na</a></code>, which replaces an NA value with a specified value, whereas <code><a href="http://www.rdocumentation.org/packages/naniar/topics/replace_with_na">naniar::replace_with_na</a></code> replaces a value with an NA:</p>
<ul>
<li>
<code><a href="http://www.rdocumentation.org/packages/tidyr/topics/replace_na">tidyr::replace_na</a></code>: Missing values turns into a value (NA –&gt; -99)</li>
<li>
<code><a href="http://www.rdocumentation.org/packages/naniar/topics/replace_with_na">naniar::replace_with_na</a></code>: Value becomes a missing value (-99 –&gt; NA)</li>
</ul>
<p>In this vignette, we describe some simple use cases for these functions and describe how they work.</p>
<div id="example-data" class="section level1">
<h1 class="hasAnchor">
<a href="#example-data" class="anchor"></a>Example data</h1>
<p>First, we introduce a small fictional dataset, <code>df</code>, which contains some common features of a dataset with the sorts of missing values we might encounter. This includes multiple specifications of missing values, such as “N/A”, “N A”, and “Not Available”. And also some common numeric codes, like -98, -99, and -1.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
df &lt;-<span class="st"> </span>tibble<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/tibble/topics/tribble">tribble</a></span>(
  <span class="op">~</span>name,           <span class="op">~</span>x,  <span class="op">~</span>y,              <span class="op">~</span>z,  
  <span class="st">"N/A"</span>,           <span class="dv">1</span>,   <span class="st">"N/A"</span>,           <span class="op">-</span><span class="dv">100</span>, 
  <span class="st">"N A"</span>,           <span class="dv">3</span>,   <span class="st">"NOt available"</span>, <span class="op">-</span><span class="dv">99</span>,
  <span class="st">"N / A"</span>,         <span class="ot">NA</span>,  <span class="dv">29</span>,              <span class="op">-</span><span class="dv">98</span>,
  <span class="st">"Not Available"</span>, <span class="op">-</span><span class="dv">99</span>, <span class="dv">25</span>,              <span class="op">-</span><span class="dv">101</span>,
  <span class="st">"John Smith"</span>,    <span class="op">-</span><span class="dv">98</span>, <span class="dv">28</span>,              <span class="op">-</span><span class="dv">1</span>)</code></pre></div>
<div id="using-replace_with_na" class="section level2">
<h2 class="hasAnchor">
<a href="#using-replace_with_na" class="anchor"></a>Using <code>replace_with_na</code>
</h2>
<p>What if we want to replace the value -99 in the x column with a missing value?</p>
<p>First, let’s load <code>naniar</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(naniar)</code></pre></div>
<p>Now, we specify the fact that we want to replace -99 with a missing value. To do so we use the <code>replace</code> argument, and specify a named list, which contains the names of the variable and the value it would take to replace with NA.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="../reference/replace_with_na.html">replace_with_na</a></span>(<span class="dt">replace =</span> <span class="kw">list</span>(<span class="dt">x =</span> <span class="op">-</span><span class="dv">99</span>))
<span class="co">#&gt; # A tibble: 5 x 4</span>
<span class="co">#&gt;   name               x y                   z</span>
<span class="co">#&gt;   &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;           &lt;dbl&gt;</span>
<span class="co">#&gt; 1 N/A             1.00 N/A           -100   </span>
<span class="co">#&gt; 2 N A             3.00 NOt available - 99.0 </span>
<span class="co">#&gt; 3 N / A          NA    29            - 98.0 </span>
<span class="co">#&gt; 4 Not Available  NA    25            -101   </span>
<span class="co">#&gt; 5 John Smith    -98.0  28            -  1.00</span></code></pre></div>
<p>And say we want to replace -98 as well?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="../reference/replace_with_na.html">replace_with_na</a></span>(<span class="dt">replace =</span> <span class="kw">list</span>(<span class="dt">x =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">99</span>, <span class="op">-</span><span class="dv">98</span>)))
<span class="co">#&gt; # A tibble: 5 x 4</span>
<span class="co">#&gt;   name              x y                   z</span>
<span class="co">#&gt;   &lt;chr&gt;         &lt;dbl&gt; &lt;chr&gt;           &lt;dbl&gt;</span>
<span class="co">#&gt; 1 N/A            1.00 N/A           -100   </span>
<span class="co">#&gt; 2 N A            3.00 NOt available - 99.0 </span>
<span class="co">#&gt; 3 N / A         NA    29            - 98.0 </span>
<span class="co">#&gt; 4 Not Available NA    25            -101   </span>
<span class="co">#&gt; 5 John Smith    NA    28            -  1.00</span></code></pre></div>
<p>And then what if we want to replace -99 and -98 in all the numeric columns, x and z?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="../reference/replace_with_na.html">replace_with_na</a></span>(<span class="dt">replace =</span> <span class="kw">list</span>(<span class="dt">x =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">99</span>,<span class="op">-</span><span class="dv">98</span>),
                             <span class="dt">z =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">99</span>, <span class="op">-</span><span class="dv">98</span>)))
<span class="co">#&gt; # A tibble: 5 x 4</span>
<span class="co">#&gt;   name              x y                   z</span>
<span class="co">#&gt;   &lt;chr&gt;         &lt;dbl&gt; &lt;chr&gt;           &lt;dbl&gt;</span>
<span class="co">#&gt; 1 N/A            1.00 N/A           -100   </span>
<span class="co">#&gt; 2 N A            3.00 NOt available   NA   </span>
<span class="co">#&gt; 3 N / A         NA    29              NA   </span>
<span class="co">#&gt; 4 Not Available NA    25            -101   </span>
<span class="co">#&gt; 5 John Smith    NA    28            -  1.00</span></code></pre></div>
<p>Using <code>replace_with_na</code> works well when we know the exact value to be replaced, and for which variables we want to replace, providing there are not many variables. But what do you do when you’ve got many variables you want to observe?</p>
</div>
<div id="extending-replace_with_na" class="section level2">
<h2 class="hasAnchor">
<a href="#extending-replace_with_na" class="anchor"></a>Extending <code>replace_with_na</code>
</h2>
<p>Sometimes you have many of the same value that you want to replace. For example, -99 and -98 above, and also the variants of “NA”, such as “N/A”, and “N / A”, and “Not Available”. You might also have certain variables that you want to be affected by these rules, or you might have more complex rules, like, “only affect variables that are numeric, or character, with this rule”.</p>
<p>To account for these cases we have borrowed from <a href="http://dplyr.tidyverse.org/reference/scoped.html"><code>dplyr</code>’s scoped variants</a> and created the functions:</p>
<ul>
<li>
<code><a href="../reference/replace_with_na_all.html">replace_with_na_all()</a></code> Replaces NA for all variables.</li>
<li>
<code><a href="../reference/replace_with_na_at.html">replace_with_na_at()</a></code> Replaces NA on a subset of variables specified with character quotes (e.g., c(“var1”, “var2”)).</li>
<li>
<code><a href="../reference/replace_with_na_if.html">replace_with_na_if()</a></code> Replaces NA based on applying an operation on the subset of variables for which a predicate function (is.numeric, is.character, etc) returns TRUE.</li>
</ul>
<p>Below we will now consider some very simple examples of the use of these functions, so that you can better understand how to use them.</p>
</div>
<div id="using-replace_with_na_all" class="section level2">
<h2 class="hasAnchor">
<a href="#using-replace_with_na_all" class="anchor"></a>Using <code>replace_with_na_all</code>
</h2>
<p>Use <code>replace_with_na_all</code> when you want to replace ALL values that meet a condition across an entire dataset. The syntax here is a little different, and follows the rules for rlang’s expression of simple functions. This means that the function starts with <code>~</code>, and when referencing a variable, you use <code>.x</code>.</p>
<p>For example, if we want to replace all cases of -99 in our dataset, we write:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="../reference/replace_with_na_all.html">replace_with_na_all</a></span>(<span class="dt">condition =</span> <span class="op">~</span>.x <span class="op">==</span><span class="st"> </span><span class="op">-</span><span class="dv">99</span>)
<span class="co">#&gt; # A tibble: 5 x 4</span>
<span class="co">#&gt;   name               x y                   z</span>
<span class="co">#&gt;   &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;           &lt;dbl&gt;</span>
<span class="co">#&gt; 1 N/A             1.00 N/A           -100   </span>
<span class="co">#&gt; 2 N A             3.00 NOt available   NA   </span>
<span class="co">#&gt; 3 N / A          NA    29            - 98.0 </span>
<span class="co">#&gt; 4 Not Available  NA    25            -101   </span>
<span class="co">#&gt; 5 John Smith    -98.0  28            -  1.00</span></code></pre></div>
<p>Likewise, if you have a set of (annoying) repeating strings like various spellings of “NA”, then I suggest you first lay out all the offending cases:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
<span class="co"># write out all the offending strings</span>
na_strings &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">"NA"</span>, <span class="st">"N A"</span>, <span class="st">"N / A"</span>, <span class="st">"N/A"</span>, <span class="st">"N/ A"</span>, <span class="st">"Not Available"</span>, <span class="st">"NOt available"</span>)</code></pre></div>
<p>Then you write <code>~.x %in% na_strings</code> - which reads as “does this value occur in the list of NA strings”.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
df <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="../reference/replace_with_na_all.html">replace_with_na_all</a></span>(<span class="dt">condition =</span> <span class="op">~</span>.x <span class="op">%in%</span><span class="st"> </span>na_strings)
<span class="co">#&gt; # A tibble: 5 x 4</span>
<span class="co">#&gt;   name            x y           z</span>
<span class="co">#&gt;   &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt;</span>
<span class="co">#&gt; 1 &lt;NA&gt;         1.00 &lt;NA&gt;  -100   </span>
<span class="co">#&gt; 2 &lt;NA&gt;         3.00 &lt;NA&gt;  - 99.0 </span>
<span class="co">#&gt; 3 &lt;NA&gt;        NA    29    - 98.0 </span>
<span class="co">#&gt; 4 &lt;NA&gt;       -99.0  25    -101   </span>
<span class="co">#&gt; 5 John Smith -98.0  28    -  1.00</span></code></pre></div>
<div id="replace_with_na_at" class="section level3">
<h3 class="hasAnchor">
<a href="#replace_with_na_at" class="anchor"></a><code>replace_with_na_at</code>
</h3>
<p>This is similar to <code>_all</code>, but instead in this case you can specify the variables that you want affected by the rule that you state. This is useful in cases where you want to specify a rule that only affects a selected number of variables.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
df <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="../reference/replace_with_na_at.html">replace_with_na_at</a></span>(<span class="dt">.vars =</span> <span class="kw">c</span>(<span class="st">"x"</span>,<span class="st">"z"</span>),
                     <span class="dt">condition =</span> <span class="op">~</span>.x <span class="op">==</span><span class="st"> </span><span class="op">-</span><span class="dv">99</span>)
<span class="co">#&gt; # A tibble: 5 x 4</span>
<span class="co">#&gt;   name               x y                   z</span>
<span class="co">#&gt;   &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;           &lt;dbl&gt;</span>
<span class="co">#&gt; 1 N/A             1.00 N/A           -100   </span>
<span class="co">#&gt; 2 N A             3.00 NOt available   NA   </span>
<span class="co">#&gt; 3 N / A          NA    29            - 98.0 </span>
<span class="co">#&gt; 4 Not Available  NA    25            -101   </span>
<span class="co">#&gt; 5 John Smith    -98.0  28            -  1.00</span></code></pre></div>
<p>Although you can achieve this with regular <code>replace_with_na</code>, it is more concise to use, <code>replace_with_na_at</code>. Additionally, you can specify rules as function, for example, make a value NA if the exponent of that number is less than 1:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
df <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="../reference/replace_with_na_at.html">replace_with_na_at</a></span>(<span class="dt">.vars =</span> <span class="kw">c</span>(<span class="st">"x"</span>,<span class="st">"z"</span>),
                     <span class="dt">condition =</span> <span class="op">~</span><span class="st"> </span><span class="kw">exp</span>(.x) <span class="op">&lt;</span><span class="st"> </span><span class="dv">1</span>)
<span class="co">#&gt; # A tibble: 5 x 4</span>
<span class="co">#&gt;   name              x y             z    </span>
<span class="co">#&gt;   &lt;chr&gt;         &lt;dbl&gt; &lt;chr&gt;         &lt;lgl&gt;</span>
<span class="co">#&gt; 1 N/A            1.00 N/A           NA   </span>
<span class="co">#&gt; 2 N A            3.00 NOt available NA   </span>
<span class="co">#&gt; 3 N / A         NA    29            NA   </span>
<span class="co">#&gt; 4 Not Available NA    25            NA   </span>
<span class="co">#&gt; 5 John Smith    NA    28            NA</span></code></pre></div>
</div>
<div id="replace_with_na_if" class="section level3">
<h3 class="hasAnchor">
<a href="#replace_with_na_if" class="anchor"></a><code>replace_with_na_if</code>
</h3>
<p>There may be some cases where you can identify variables based on some test - <code>is.character</code> - are they character variables? <code>is.numeric</code> - Are they numeric or double? and a given value inside that type of data. For example,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
df <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="../reference/replace_with_na_if.html">replace_with_na_if</a></span>(<span class="dt">.predicate =</span> is.character,
                     <span class="dt">condition =</span> <span class="op">~</span>.x <span class="op">%in%</span><span class="st"> </span>(<span class="st">"N/A"</span>))
<span class="co">#&gt; # A tibble: 5 x 4</span>
<span class="co">#&gt;   name               x y                   z</span>
<span class="co">#&gt;   &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;           &lt;dbl&gt;</span>
<span class="co">#&gt; 1 &lt;NA&gt;            1.00 &lt;NA&gt;          -100   </span>
<span class="co">#&gt; 2 N A             3.00 NOt available - 99.0 </span>
<span class="co">#&gt; 3 N / A          NA    29            - 98.0 </span>
<span class="co">#&gt; 4 Not Available -99.0  25            -101   </span>
<span class="co">#&gt; 5 John Smith    -98.0  28            -  1.00</span>

<span class="co"># or</span>
df <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="../reference/replace_with_na_if.html">replace_with_na_if</a></span>(<span class="dt">.predicate =</span> is.character,
                     <span class="dt">condition =</span> <span class="op">~</span>.x <span class="op">%in%</span><span class="st"> </span>(na_strings))
<span class="co">#&gt; # A tibble: 5 x 4</span>
<span class="co">#&gt;   name            x y           z</span>
<span class="co">#&gt;   &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt;</span>
<span class="co">#&gt; 1 &lt;NA&gt;         1.00 &lt;NA&gt;  -100   </span>
<span class="co">#&gt; 2 &lt;NA&gt;         3.00 &lt;NA&gt;  - 99.0 </span>
<span class="co">#&gt; 3 &lt;NA&gt;        NA    29    - 98.0 </span>
<span class="co">#&gt; 4 &lt;NA&gt;       -99.0  25    -101   </span>
<span class="co">#&gt; 5 John Smith -98.0  28    -  1.00</span></code></pre></div>
<p>This means that you are able to apply a rule to many variables that meet a pre-specified condition. This can be of particular use if you have many variables and don’t want to list them all, and also if you know that there is a particular problem for variables of a particular class.</p>
</div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li>
<a href="#example-data">Example data</a><ul class="nav nav-pills nav-stacked">
<li><a href="#using-replace_with_na">Using <code>replace_with_na</code></a></li>
      <li><a href="#extending-replace_with_na">Extending <code>replace_with_na</code></a></li>
      <li><a href="#using-replace_with_na_all">Using <code>replace_with_na_all</code></a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Nicholas Tierney, Di Cook, Miles McBain, Colin Fay.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
